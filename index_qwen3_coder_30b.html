<div id="number-list">
  <p class="number" draggable="true" data-index="0"></p>
  <p class="number" draggable="true" data-index="1"></p>
  <p class="number" draggable="true" data-index="2"></p>
  <p class="number" draggable="true" data-index="3"></p>
  <p class="number" draggable="true" data-index="4"></p>
</div>

<script>
(() => {
  const componentId = 'number-list';
  const container = document.getElementById(componentId);
  if (!container) return;

  const generateRandomNumber = () => Math.floor(Math.random() * 500) + 1;
  const paragraphs = container.querySelectorAll('.number');
  let draggedElement = null;

  paragraphs.forEach((p, index) => {
    p.textContent = generateRandomNumber();
    p.setAttribute('data-index', index);
  });

  container.addEventListener('dragstart', (e) => {
    if (e.target.classList.contains('number')) {
      draggedElement = e.target;
      draggedElement.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }
  });

  container.addEventListener('dragend', () => {
    if (draggedElement) {
      draggedElement.classList.remove('dragging');
      draggedElement = null;
    }
  });

  container.addEventListener('dragover', (e) => {
    e.preventDefault();
    if (!draggedElement) return;

    const targetElement = e.target.closest('.number');
    if (!targetElement || targetElement === draggedElement) return;

    const targetIndex = parseInt(targetElement.getAttribute('data-index'));
    const draggedIndex = parseInt(draggedElement.getAttribute('data-index'));

    if (targetIndex !== draggedIndex) {
      const parent = draggedElement.parentNode;
      if (targetIndex > draggedIndex) {
        parent.insertBefore(draggedElement, targetElement.nextSibling);
      } else {
        parent.insertBefore(draggedElement, targetElement);
      }

      const newDraggedIndex = parseInt(draggedElement.getAttribute('data-index'));
      const event = new CustomEvent(`component_${componentId}_number_${newDraggedIndex}_dragging`, {
        detail: { draggedIndex, targetIndex }
      });
      document.dispatchEvent(event);

      paragraphs.forEach((p, index) => {
        p.setAttribute('data-index', index);
      });
    }
  });
})();
</script>

