<div id="number-list">
  <div id="status">moving status</div>
</div>
<script>
(() => {
  const componentId = 'number-list';
  const container = document.getElementById(componentId);
  const statusDiv = document.getElementById('status');
  const numbers = [];
  
  // Generate 8 random numbers between 1 and 1000
  for (let i = 0; i < 8; i++) {
    numbers.push(Math.floor(Math.random() * 1000) + 1);
  }
  
  // Create paragraphs
  numbers.forEach((num, index) => {
    const p = document.createElement('p');
    p.className = 'number';
    p.textContent = num;
    p.setAttribute('data-index', index);
    container.appendChild(p);
  });
  
  // Drag and drop functionality
  let draggedElement = null;
  let initialIndex = null;
  
  container.addEventListener('dragstart', (e) => {
    if (e.target.classList.contains('number')) {
      draggedElement = e.target;
      initialIndex = parseInt(draggedElement.getAttribute('data-index'));
      e.dataTransfer.effectAllowed = 'move';
      const event = new CustomEvent(`component_${componentId}_number_${initialIndex}_drag_start`, {
        detail: { index: initialIndex }
      });
      window.dispatchEvent(event);
      statusDiv.textContent = "drag started";
    }
  });
  
  container.addEventListener('dragover', (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    
    if (draggedElement && e.target.classList.contains('number')) {
      const targetElement = e.target;
      const targetRect = targetElement.getBoundingClientRect();
      const clientY = e.clientY;
      
      if (clientY < targetRect.top + targetRect.height / 2) {
        if (draggedElement !== targetElement) {
          targetElement.parentNode.insertBefore(draggedElement, targetElement);
        }
      } else {
        if (draggedElement !== targetElement.nextSibling) {
          targetElement.parentNode.insertBefore(draggedElement, targetElement.nextSibling);
        }
      }
      
      const paragraphs = container.querySelectorAll('.number');
      paragraphs.forEach((p, index) => {
        p.setAttribute('data-index', index);
      });
      
      const draggedText = draggedElement.textContent;
      const targetText = targetElement.textContent;
      if (draggedText !== targetText) {
        statusDiv.textContent = `${draggedText} is over ${targetText}`;
      }
      
      const event = new CustomEvent(`component_${componentId}_number_${initialIndex}_drag_ongoing`, {
        detail: { index: initialIndex }
      });
      window.dispatchEvent(event);
    }
  });
  
  container.addEventListener('dragend', (e) => {
    if (e.target.classList.contains('number')) {
      e.target.style.opacity = '';
      draggedElement = null;
      initialIndex = null;
      
      const event = new CustomEvent(`component_${componentId}_number_${initialIndex}_drag_ended`, {
        detail: { index: initialIndex }
      });
      window.dispatchEvent(event);
      statusDiv.textContent = "drag ended";
    }
  });
  
  // Make elements draggable
  const paragraphs = container.querySelectorAll('.number');
  paragraphs.forEach(p => {
    p.setAttribute('draggable', 'true');
  });
})();
</script>

